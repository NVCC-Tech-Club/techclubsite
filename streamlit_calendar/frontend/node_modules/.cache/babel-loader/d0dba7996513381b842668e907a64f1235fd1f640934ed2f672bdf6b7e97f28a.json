{"ast":null,"code":"import { __assign } from \"tslib\";\nimport { Frequency } from './types';\nimport { Weekday } from './weekday';\nimport { untilStringToDate } from './dateutil';\nimport { Days } from './rrule';\nexport function parseString(rfcString) {\n  var options = rfcString.split('\\n').map(parseLine).filter(function (x) {\n    return x !== null;\n  });\n  return __assign(__assign({}, options[0]), options[1]);\n}\nexport function parseDtstart(line) {\n  var options = {};\n  var dtstartWithZone = /DTSTART(?:;TZID=([^:=]+?))?(?::|=)([^;\\s]+)/i.exec(line);\n  if (!dtstartWithZone) {\n    return options;\n  }\n  var tzid = dtstartWithZone[1],\n    dtstart = dtstartWithZone[2];\n  if (tzid) {\n    options.tzid = tzid;\n  }\n  options.dtstart = untilStringToDate(dtstart);\n  return options;\n}\nfunction parseLine(rfcString) {\n  rfcString = rfcString.replace(/^\\s+|\\s+$/, '');\n  if (!rfcString.length) return null;\n  var header = /^([A-Z]+?)[:;]/.exec(rfcString.toUpperCase());\n  if (!header) {\n    return parseRrule(rfcString);\n  }\n  var key = header[1];\n  switch (key.toUpperCase()) {\n    case 'RRULE':\n    case 'EXRULE':\n      return parseRrule(rfcString);\n    case 'DTSTART':\n      return parseDtstart(rfcString);\n    default:\n      throw new Error(\"Unsupported RFC prop \".concat(key, \" in \").concat(rfcString));\n  }\n}\nfunction parseRrule(line) {\n  var strippedLine = line.replace(/^RRULE:/i, '');\n  var options = parseDtstart(strippedLine);\n  var attrs = line.replace(/^(?:RRULE|EXRULE):/i, '').split(';');\n  attrs.forEach(function (attr) {\n    var _a = attr.split('='),\n      key = _a[0],\n      value = _a[1];\n    switch (key.toUpperCase()) {\n      case 'FREQ':\n        options.freq = Frequency[value.toUpperCase()];\n        break;\n      case 'WKST':\n        options.wkst = Days[value.toUpperCase()];\n        break;\n      case 'COUNT':\n      case 'INTERVAL':\n      case 'BYSETPOS':\n      case 'BYMONTH':\n      case 'BYMONTHDAY':\n      case 'BYYEARDAY':\n      case 'BYWEEKNO':\n      case 'BYHOUR':\n      case 'BYMINUTE':\n      case 'BYSECOND':\n        var num = parseNumber(value);\n        var optionKey = key.toLowerCase();\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore\n        options[optionKey] = num;\n        break;\n      case 'BYWEEKDAY':\n      case 'BYDAY':\n        options.byweekday = parseWeekday(value);\n        break;\n      case 'DTSTART':\n      case 'TZID':\n        // for backwards compatibility\n        var dtstart = parseDtstart(line);\n        options.tzid = dtstart.tzid;\n        options.dtstart = dtstart.dtstart;\n        break;\n      case 'UNTIL':\n        options.until = untilStringToDate(value);\n        break;\n      case 'BYEASTER':\n        options.byeaster = Number(value);\n        break;\n      default:\n        throw new Error(\"Unknown RRULE property '\" + key + \"'\");\n    }\n  });\n  return options;\n}\nfunction parseNumber(value) {\n  if (value.indexOf(',') !== -1) {\n    var values = value.split(',');\n    return values.map(parseIndividualNumber);\n  }\n  return parseIndividualNumber(value);\n}\nfunction parseIndividualNumber(value) {\n  if (/^[+-]?\\d+$/.test(value)) {\n    return Number(value);\n  }\n  return value;\n}\nfunction parseWeekday(value) {\n  var days = value.split(',');\n  return days.map(function (day) {\n    if (day.length === 2) {\n      // MO, TU, ...\n      return Days[day]; // wday instanceof Weekday\n    }\n    // -1MO, +3FR, 1SO, 13TU ...\n    var parts = day.match(/^([+-]?\\d{1,2})([A-Z]{2})$/);\n    if (!parts || parts.length < 3) {\n      throw new SyntaxError(\"Invalid weekday string: \".concat(day));\n    }\n    var n = Number(parts[1]);\n    var wdaypart = parts[2];\n    var wday = Days[wdaypart].weekday;\n    return new Weekday(wday, n);\n  });\n}","map":{"version":3,"names":["Frequency","Weekday","untilStringToDate","Days","parseString","rfcString","options","split","map","parseLine","filter","x","__assign","parseDtstart","line","dtstartWithZone","exec","tzid","dtstart","replace","length","header","toUpperCase","parseRrule","key","Error","concat","strippedLine","attrs","forEach","attr","_a","value","freq","wkst","num","parseNumber","optionKey","toLowerCase","byweekday","parseWeekday","until","byeaster","Number","indexOf","values","parseIndividualNumber","test","days","day","parts","match","SyntaxError","n","wdaypart","wday","weekday"],"sources":["../../src/parsestring.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}