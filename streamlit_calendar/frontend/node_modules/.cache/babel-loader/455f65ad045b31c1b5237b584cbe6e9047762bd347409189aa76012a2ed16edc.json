{"ast":null,"code":"import { __extends } from \"tslib\";\nimport { RRule } from './rrule';\nimport { sort, timeToUntilString } from './dateutil';\nimport { includes } from './helpers';\nimport { iterSet } from './iterset';\nimport { rrulestr } from './rrulestr';\nimport { optionsToString } from './optionstostring';\nfunction createGetterSetter(fieldName) {\n  var _this = this;\n  return function (field) {\n    if (field !== undefined) {\n      _this[\"_\".concat(fieldName)] = field;\n    }\n    if (_this[\"_\".concat(fieldName)] !== undefined) {\n      return _this[\"_\".concat(fieldName)];\n    }\n    for (var i = 0; i < _this._rrule.length; i++) {\n      var field_1 = _this._rrule[i].origOptions[fieldName];\n      if (field_1) {\n        return field_1;\n      }\n    }\n  };\n}\nvar RRuleSet = /** @class */function (_super) {\n  __extends(RRuleSet, _super);\n  /**\n   *\n   * @param {Boolean?} noCache\n   * The same stratagy as RRule on cache, default to false\n   * @constructor\n   */\n  function RRuleSet(noCache) {\n    if (noCache === void 0) {\n      noCache = false;\n    }\n    var _this = _super.call(this, {}, noCache) || this;\n    _this.dtstart = createGetterSetter.apply(_this, ['dtstart']);\n    _this.tzid = createGetterSetter.apply(_this, ['tzid']);\n    _this._rrule = [];\n    _this._rdate = [];\n    _this._exrule = [];\n    _this._exdate = [];\n    return _this;\n  }\n  RRuleSet.prototype._iter = function (iterResult) {\n    return iterSet(iterResult, this._rrule, this._exrule, this._rdate, this._exdate, this.tzid());\n  };\n  /**\n   * Adds an RRule to the set\n   *\n   * @param {RRule}\n   */\n  RRuleSet.prototype.rrule = function (rrule) {\n    _addRule(rrule, this._rrule);\n  };\n  /**\n   * Adds an EXRULE to the set\n   *\n   * @param {RRule}\n   */\n  RRuleSet.prototype.exrule = function (rrule) {\n    _addRule(rrule, this._exrule);\n  };\n  /**\n   * Adds an RDate to the set\n   *\n   * @param {Date}\n   */\n  RRuleSet.prototype.rdate = function (date) {\n    _addDate(date, this._rdate);\n  };\n  /**\n   * Adds an EXDATE to the set\n   *\n   * @param {Date}\n   */\n  RRuleSet.prototype.exdate = function (date) {\n    _addDate(date, this._exdate);\n  };\n  /**\n   * Get list of included rrules in this recurrence set.\n   *\n   * @return List of rrules\n   */\n  RRuleSet.prototype.rrules = function () {\n    return this._rrule.map(function (e) {\n      return rrulestr(e.toString());\n    });\n  };\n  /**\n   * Get list of excluded rrules in this recurrence set.\n   *\n   * @return List of exrules\n   */\n  RRuleSet.prototype.exrules = function () {\n    return this._exrule.map(function (e) {\n      return rrulestr(e.toString());\n    });\n  };\n  /**\n   * Get list of included datetimes in this recurrence set.\n   *\n   * @return List of rdates\n   */\n  RRuleSet.prototype.rdates = function () {\n    return this._rdate.map(function (e) {\n      return new Date(e.getTime());\n    });\n  };\n  /**\n   * Get list of included datetimes in this recurrence set.\n   *\n   * @return List of exdates\n   */\n  RRuleSet.prototype.exdates = function () {\n    return this._exdate.map(function (e) {\n      return new Date(e.getTime());\n    });\n  };\n  RRuleSet.prototype.valueOf = function () {\n    var result = [];\n    if (!this._rrule.length && this._dtstart) {\n      result = result.concat(optionsToString({\n        dtstart: this._dtstart\n      }));\n    }\n    this._rrule.forEach(function (rrule) {\n      result = result.concat(rrule.toString().split('\\n'));\n    });\n    this._exrule.forEach(function (exrule) {\n      result = result.concat(exrule.toString().split('\\n').map(function (line) {\n        return line.replace(/^RRULE:/, 'EXRULE:');\n      }).filter(function (line) {\n        return !/^DTSTART/.test(line);\n      }));\n    });\n    if (this._rdate.length) {\n      result.push(rdatesToString('RDATE', this._rdate, this.tzid()));\n    }\n    if (this._exdate.length) {\n      result.push(rdatesToString('EXDATE', this._exdate, this.tzid()));\n    }\n    return result;\n  };\n  /**\n   * to generate recurrence field such as:\n   * DTSTART:19970902T010000Z\n   * RRULE:FREQ=YEARLY;COUNT=2;BYDAY=TU\n   * RRULE:FREQ=YEARLY;COUNT=1;BYDAY=TH\n   */\n  RRuleSet.prototype.toString = function () {\n    return this.valueOf().join('\\n');\n  };\n  /**\n   * Create a new RRuleSet Object completely base on current instance\n   */\n  RRuleSet.prototype.clone = function () {\n    var rrs = new RRuleSet(!!this._cache);\n    this._rrule.forEach(function (rule) {\n      return rrs.rrule(rule.clone());\n    });\n    this._exrule.forEach(function (rule) {\n      return rrs.exrule(rule.clone());\n    });\n    this._rdate.forEach(function (date) {\n      return rrs.rdate(new Date(date.getTime()));\n    });\n    this._exdate.forEach(function (date) {\n      return rrs.exdate(new Date(date.getTime()));\n    });\n    return rrs;\n  };\n  return RRuleSet;\n}(RRule);\nexport { RRuleSet };\nfunction _addRule(rrule, collection) {\n  if (!(rrule instanceof RRule)) {\n    throw new TypeError(String(rrule) + ' is not RRule instance');\n  }\n  if (!includes(collection.map(String), String(rrule))) {\n    collection.push(rrule);\n  }\n}\nfunction _addDate(date, collection) {\n  if (!(date instanceof Date)) {\n    throw new TypeError(String(date) + ' is not Date instance');\n  }\n  if (!includes(collection.map(Number), Number(date))) {\n    collection.push(date);\n    sort(collection);\n  }\n}\nfunction rdatesToString(param, rdates, tzid) {\n  var isUTC = !tzid || tzid.toUpperCase() === 'UTC';\n  var header = isUTC ? \"\".concat(param, \":\") : \"\".concat(param, \";TZID=\").concat(tzid, \":\");\n  var dateString = rdates.map(function (rdate) {\n    return timeToUntilString(rdate.valueOf(), isUTC);\n  }).join(',');\n  return \"\".concat(header).concat(dateString);\n}","map":{"version":3,"names":["RRule","sort","timeToUntilString","includes","iterSet","rrulestr","optionsToString","createGetterSetter","fieldName","_this","field","undefined","concat","i","_rrule","length","field_1","origOptions","RRuleSet","_super","__extends","noCache","call","dtstart","apply","tzid","_rdate","_exrule","_exdate","prototype","_iter","iterResult","rrule","_addRule","exrule","rdate","date","_addDate","exdate","rrules","map","e","toString","exrules","rdates","Date","getTime","exdates","valueOf","result","_dtstart","forEach","split","line","replace","filter","test","push","rdatesToString","join","clone","rrs","_cache","rule","collection","TypeError","String","Number","param","isUTC","toUpperCase","header","dateString"],"sources":["../../src/rruleset.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}