{"ast":null,"code":"import IterResult from './iterresult';\nimport { clone, cloneDates } from './dateutil';\nimport { isArray } from './helpers';\nfunction argsMatch(left, right) {\n  if (Array.isArray(left)) {\n    if (!Array.isArray(right)) return false;\n    if (left.length !== right.length) return false;\n    return left.every(function (date, i) {\n      return date.getTime() === right[i].getTime();\n    });\n  }\n  if (left instanceof Date) {\n    return right instanceof Date && left.getTime() === right.getTime();\n  }\n  return left === right;\n}\nvar Cache = /** @class */function () {\n  function Cache() {\n    this.all = false;\n    this.before = [];\n    this.after = [];\n    this.between = [];\n  }\n  /**\n   * @param {String} what - all/before/after/between\n   * @param {Array,Date} value - an array of dates, one date, or null\n   * @param {Object?} args - _iter arguments\n   */\n  Cache.prototype._cacheAdd = function (what, value, args) {\n    if (value) {\n      value = value instanceof Date ? clone(value) : cloneDates(value);\n    }\n    if (what === 'all') {\n      this.all = value;\n    } else {\n      args._value = value;\n      this[what].push(args);\n    }\n  };\n  /**\n   * @return false - not in the cache\n   * @return null  - cached, but zero occurrences (before/after)\n   * @return Date  - cached (before/after)\n   * @return []    - cached, but zero occurrences (all/between)\n   * @return [Date1, DateN] - cached (all/between)\n   */\n  Cache.prototype._cacheGet = function (what, args) {\n    var cached = false;\n    var argsKeys = args ? Object.keys(args) : [];\n    var findCacheDiff = function (item) {\n      for (var i = 0; i < argsKeys.length; i++) {\n        var key = argsKeys[i];\n        if (!argsMatch(args[key], item[key])) {\n          return true;\n        }\n      }\n      return false;\n    };\n    var cachedObject = this[what];\n    if (what === 'all') {\n      cached = this.all;\n    } else if (isArray(cachedObject)) {\n      // Let's see whether we've already called the\n      // 'what' method with the same 'args'\n      for (var i = 0; i < cachedObject.length; i++) {\n        var item = cachedObject[i];\n        if (argsKeys.length && findCacheDiff(item)) continue;\n        cached = item._value;\n        break;\n      }\n    }\n    if (!cached && this.all) {\n      // Not in the cache, but we already know all the occurrences,\n      // so we can find the correct dates from the cached ones.\n      var iterResult = new IterResult(what, args);\n      for (var i = 0; i < this.all.length; i++) {\n        if (!iterResult.accept(this.all[i])) break;\n      }\n      cached = iterResult.getValue();\n      this._cacheAdd(what, cached, args);\n    }\n    return isArray(cached) ? cloneDates(cached) : cached instanceof Date ? clone(cached) : cached;\n  };\n  return Cache;\n}();\nexport { Cache };","map":{"version":3,"names":["IterResult","clone","cloneDates","isArray","argsMatch","left","right","Array","length","every","date","i","getTime","Date","Cache","all","before","after","between","prototype","_cacheAdd","what","value","args","_value","push","_cacheGet","cached","argsKeys","Object","keys","findCacheDiff","item","key","cachedObject","iterResult","accept","getValue"],"sources":["../../src/cache.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}