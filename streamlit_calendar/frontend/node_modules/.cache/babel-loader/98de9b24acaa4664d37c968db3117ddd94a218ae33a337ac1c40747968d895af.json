{"ast":null,"code":"import { DateWithZone } from './datewithzone';\nimport { iter } from './iter';\nimport { sort } from './dateutil';\nexport function iterSet(iterResult, _rrule, _exrule, _rdate, _exdate, tzid) {\n  var _exdateHash = {};\n  var _accept = iterResult.accept;\n  function evalExdate(after, before) {\n    _exrule.forEach(function (rrule) {\n      rrule.between(after, before, true).forEach(function (date) {\n        _exdateHash[Number(date)] = true;\n      });\n    });\n  }\n  _exdate.forEach(function (date) {\n    var zonedDate = new DateWithZone(date, tzid).rezonedDate();\n    _exdateHash[Number(zonedDate)] = true;\n  });\n  iterResult.accept = function (date) {\n    var dt = Number(date);\n    if (isNaN(dt)) return _accept.call(this, date);\n    if (!_exdateHash[dt]) {\n      evalExdate(new Date(dt - 1), new Date(dt + 1));\n      if (!_exdateHash[dt]) {\n        _exdateHash[dt] = true;\n        return _accept.call(this, date);\n      }\n    }\n    return true;\n  };\n  if (iterResult.method === 'between') {\n    evalExdate(iterResult.args.after, iterResult.args.before);\n    iterResult.accept = function (date) {\n      var dt = Number(date);\n      if (!_exdateHash[dt]) {\n        _exdateHash[dt] = true;\n        return _accept.call(this, date);\n      }\n      return true;\n    };\n  }\n  for (var i = 0; i < _rdate.length; i++) {\n    var zonedDate = new DateWithZone(_rdate[i], tzid).rezonedDate();\n    if (!iterResult.accept(new Date(zonedDate.getTime()))) break;\n  }\n  _rrule.forEach(function (rrule) {\n    iter(iterResult, rrule.options);\n  });\n  var res = iterResult._result;\n  sort(res);\n  switch (iterResult.method) {\n    case 'all':\n    case 'between':\n      return res;\n    case 'before':\n      return res.length && res[res.length - 1] || null;\n    case 'after':\n    default:\n      return res.length && res[0] || null;\n  }\n}","map":{"version":3,"names":["DateWithZone","iter","sort","iterSet","iterResult","_rrule","_exrule","_rdate","_exdate","tzid","_exdateHash","_accept","accept","evalExdate","after","before","forEach","rrule","between","date","Number","zonedDate","rezonedDate","dt","isNaN","call","Date","method","args","i","length","getTime","options","res","_result"],"sources":["../../src/iterset.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}